# 自动巫师烹饪

## 功能介绍 <Badge type="tip" text="Introduction" />

**自动巫师烹饪**实现了简单的烹饪流程自动化。选定指定菜谱并点击启动即可。

- **使用场景**：烹饪工作台主页面，或订单挑战页面，或烹饪过程任意阶段。
- **任务流程**：
  - 准备阶段：工具会自动点击订单挑战，选择目标菜谱并点击开始。
  - 烹饪初始：工具会首先初始化所有目标位置，然后会根据[配置](#配置说明)文件的内容，将对应食材拖动到对应器具。
  - 烹饪循环：工具会实时检测厨具的状态，当所有厨具同时处于烹饪完成状态时，会重复厨具->砧板，食材->厨具，调料->砧板，砧板->订单的循环过程。
  - 异常恢复：当检测到有厨具烤糊，工具会将所有食材（包括砧板）丢弃到回收处，然后重复检测过程。
  - 烹饪结束：烹饪结束会累加烹饪计数，达到目标次数自动退出任务。

- **终止条件**：手动终止或达到次数自动终止。

## 参数设置 <Badge type="tip" text="Settings" />

- **烹饪次数**：烹饪目标次数，达到次数自动终止。
- **选择菜品**：选择目标菜品，菜品从配置文件中读取。
- **OCR引擎**：OCR文字识别的引擎，支持`PaddleOCR`(较慢但准确率高)和`Tesseract`(速度快但精度低)。


## 配置说明 <Badge type="tip" text="Config" />

在应用程序目录的`./Assets/Cooking/Config/`目录中存放了菜谱对应的配置信息，记录每个菜谱的信息。

以`黄金海鱼焗饭`为例：

```json
{
  "Name": "黄金海鱼焗饭",
  "ImagePath": "Dishes/海鱼黄金焗饭.png",
  "RequiredKitchenware": [
    "bin",
    "board",
    "oven",
    "pot"
  ],
  "RequiredIngredients": [
    "rice",
    "fish"
  ],
  "RequiredCondiments": [
    "cream",
    "onion"
  ],
  "CookingSteps": [
    {
      "Ingredient": "fish",
      "TargetKitchenware": "oven"
    },
    {
      "Ingredient": "rice",
      "TargetKitchenware": "pot"
    }
  ],
  "CondimentPositions": {
    "cream": 3,
    "onion": 4
  }
}
```

说明如下：
- Name：菜谱名称
- ImagePath：菜谱图像路径，相较于`/Assets/Cooking/Image/`，用于在订单挑战中进行匹配
- RequiredKitchenware：需要的厨具
- RequiredIngredients：需要的食材
- RequiredCondiments：需要的调料
- CookingSteps：定义了烹饪的流程，比如每个食材放到哪个厨具，以及各个调料在订单下方所占的位置（目前暂时没用，详见[注意事项](#注意事项)第3条）

程序启动阶段，工具会读入所有的配置文件，从而判断哪些菜谱已就绪，在烹饪时供选择使用。

理论上用户可通过自定义配置文件，实现更多样的菜谱烹饪，但是由于素材图并未完全收集，此功能可能后续才能开放。

## 使用截图 <Badge type="tip" text="Screenshots" />
**烹饪中**：
<img src="/features/cooking/cooking.png" style="width:80%;"/>

## 注意事项 <Badge type="warning" text="Note" />

- 自动巫师烹饪目前无法保证金色品质！请谨慎使用。
- 烹饪过程中，请勿将鼠标移动到MuMu模拟器窗口内拖动，否则会影响鼠标模拟操作。
- 目前仅支持单个菜品的烹饪，多菜品同时烹饪暂不考虑。
- 目前实现的烹饪流程是每个调料默认添加1个。这是权衡了文字识别延时对分数影响之后做出的决定，后续会尝试寻求优化方法。

## 常见问题 <Badge type="danger" text="questions" />

1. 烹饪结束后鼠标操作未停止？
这是正常现象，已经在每个原子操作前添加结束检测，但是由于拖拽操作的特殊性（操作本身含多个阶段，需要延时，且终点处需要多次移动确认以保证拖动成功，否则容易出现菜品明明拖动到订单，但是提交未成功的情况），无法完全保证结束时拖拽操作已完成。为了防止漏检测结算，对结算两阶段都进行了检测。

2. 烹饪没有完全按照订单的紧急顺序和调料要求来实现？
为了简化流程，以达到更高效率，移除了原本的多个订单的模板匹配和调料数量的OCR识别。在大部分情况下，该简化流程已能达到金色品质。