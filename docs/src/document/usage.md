# 使用说明

> [!TIP]
> 本项目仅适配**MuMu模拟器**中的<哈利波特：魔法觉醒>游戏。

## 基本用法

1. 启动 `AutoHPMA.exe`。
2. 按照界面提示配置相关参数。
3. 点击启动页面的"启动"按钮。
4. 根据需要，前往其余页面启用相关功能。

## 页面介绍

### 启动页面
<img src="/pages/homepage.png" style="width:80%;"/>

启动页面包含主程序的启动，日志窗口及遮罩窗口的设置。

主程序是所有自动任务运行的基础，它包含游戏窗口的检测和截图器的启用等等。

点击主程序的`CardExpander`可展开相关设置： 
- 触发器间隔：截图器的触发间隔，这里只影响[截屏页面](#截屏页面)的刷新频率。任务触发间隔是在任务中单独定义的。
- 实时截屏：为便于在AutoHPMA中观察游戏运行状态，添加了实时截屏功能，启用后在[截屏页面](#截屏页面)可查看实时游戏截屏。

日志窗口和遮罩窗口的`ToggleSwitch`可切换其启用与否。 
- 日志窗口：游戏窗口左上角覆盖的窗口，会实时显示当前时间，当前任务状态，以及实时的日志信息。
- 遮罩窗口：在整个游戏窗口覆盖的窗口，会实时标注任务流中图像匹配的结果。

此外，还可展开日志窗口的`CardExpander`以设置是否显示Debug信息。 

### 任务页面
<img src="/pages/taskpage.png" style="width:80%;"/>

任务页面是各项自动化任务的入口。

任务被分为"常驻功能"和"限时活动"。

点击"启动"按钮即可启动相应自动化任务，同时仅能进行一项任务。

展开`CardExpander`可进行任务参数的设置。

如需了解更多细节，请访问[功能](features/index.md)页。

### 截屏页面
<img src="/pages/screenshotpage.png" style="width:80%;"/>

截屏页面是一个实时显示当前游戏截屏的`Canvas`，实时截屏的启用和设置请见[启动页面](#启动页面)。

### 日志页面
<img src="/pages/logpage.png" style="width:80%;"/>

日志页面是独立于日志窗口的单独的日志系统。

该页面会更加详细的展示所有的日志信息。并支持用户筛选过滤目标类别的日志。

### 测试页面
<img src="/pages/testpage.png" style="width:80%;"/>

测试页面是对工具一些基础功能的测试，普通用户无需在意。

若有测试需求，可展开下方内容查看：

::: details 测试功能详述

1. 截屏测试：

对MuMu模拟器窗口进行截屏。可自定义截屏区域与文件名，结果会保存在程序安装目录的`/Captures/`文件夹。

2. 模拟点击：

对MuMu模拟器进行后台鼠标操作。目前支持后台的点击和拖拽操作。

3. 文字识别：

利用`PaddleOCR`对输入图像进行文字识别。

4. 模板匹配：

利用`MatchTemplate`实现的图像匹配功能。参数介绍：
- 源图：需要对其进行查询的原图像。
- 模板：需要查询匹配的模板图像，可以是带透明度的图像。
- 遮罩：对模板图的遮罩，黑色区域不参与匹配。未选择遮罩图时也可进行匹配。会自动根据模板的透明度生成相应的遮罩。
- Threshold：匹配阈值，越高则匹配相似度越高。
- Mode：匹配的算法。支持`OpenCV`原生的六种算法。
该匹配功能可对源图中的多个模板进行匹配。最终生成一系列匹配区域的坐标，点击`裁剪`按钮可将匹配区域裁剪为单独的图像，并保存在源图目录中。

5. 轮廓检测：

利用霍夫变换实现的简单的轮廓检测，支持线段、矩形、圆形的检测，其中矩形检测会对图像进行二值化操作后再进行检测。

6. 色彩过滤：

对目标图像进行相似色彩的过滤，在HSV颜色空间实现，输入目标颜色的16进制值以及阈值，可输出过滤后的色彩。

:::

### 热键页面
<img src="/pages/hotkeypage.png" style="width:80%;"/>

热键页面可对任务进行热键绑定，从而实现全局监听的键盘操作。支持组合键。

其中基础功能里的截图会保存在`/Captures/`目录，以`screenshot_YYYYMMDD_xxxxxx.png`的格式命名。

### 通知页面
<img src="/pages/notificationpage.png" style="width:80%;"/>

通知页面可以启用不同的通知功能，目前仅支持原生Windows通知。展开可发送测试通知。

### 设置页面
<img src="/pages/settingpage.png" style="width:80%;"/>

设置页面包含软件基础设置，日志设置以及软件信息等。

用户在此界面可清除软件偏好设置（如自动禁林探索的次数，自动巫师烹饪的菜品记录等等），不会对软件运行造成影响。

其他设置中包含日志的设置，此为独立于日志窗口和日志页面的日志系统，它会将所有日志信息保存在`/logs/`目录的日志文件中，并会自动实施清理。

## 注意事项 <Badge type="danger" text="caution" />

- AutoHPMA 目前仅与 MuMu 模拟器兼容，支持多种分辨率的窗口化模式，但是1600*900分辨率目前会出现截图异常，请不要使用，推荐分辨率1280*720。
- 为了识别的准确性，请将游戏画质设置为默认的"标准"画质，尽量不要更改任何影响画面的参数。
- 在脚本执行期间，请勿最小化游戏窗口或单击屏幕右下角的显示桌面按钮，否则可能会导致游戏窗口异常置顶。游戏窗口可以被其他窗口遮挡，不影响工具正常运行。
- 若运行过程出现异常的窗口弹出，可尝试通过多次切屏解决。如若解决不了，则需要重启电脑方能解决。


